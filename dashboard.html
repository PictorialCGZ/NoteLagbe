<!DOCTYPE html>
<html lang="en" class="bg-gray-950 text-gray-100">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NoteLagbe - Dashboard</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <script type="module" defer>
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://rsegoslplitkkrbarlxc.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJzZWdvc2xwbGl0a2tyYmFybHhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0OTI2NjUsImV4cCI6MjA2ODA2ODY2NX0.Fi7-CD0M2DHKSNmwDkQxfHeP8xpGCBDc5bgLWBAbGns"
    );

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "index.html";
    }

    window.logout = logout;

    async function loadFiles() {
      const fileList = document.getElementById("file-list");
      if (!fileList) return;

      fileList.innerHTML = "";

      const { data, error } = await supabase
        .from("filelinks")
        .select("*")
        .order("id", { ascending: true });

      if (error) {
        console.error("Failed to load files:", error.message);
        fileList.innerHTML = `<p class="text-red-500">Failed to load notes. Please try again later.</p>`;
        return;
      }

      if (!data || data.length === 0) {
        fileList.innerHTML = `<p class="text-gray-400 col-span-full text-center">No notes available yet. Check back soon!</p>`;
        return;
      }

      data.forEach((file) => {
        const card = document.createElement("a");
        card.href = file.link;
        card.target = "_blank";
        card.rel = "noopener noreferrer";
        card.className =
          "bg-gray-800 rounded-xl p-6 shadow-lg hover:shadow-2xl transition flex flex-col justify-between focus:outline-none focus:ring-4 focus:ring-blue-500";

        const title = document.createElement("h3");
        title.textContent = file.title;
        title.className = "text-white text-xl font-semibold mb-4 truncate";

        const linkInfo = document.createElement("div");
        linkInfo.className = "flex items-center text-blue-400 font-medium";

        const linkIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        linkIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
        linkIcon.setAttribute("fill", "none");
        linkIcon.setAttribute("viewBox", "0 0 24 24");
        linkIcon.setAttribute("stroke", "currentColor");
        linkIcon.setAttribute("class", "w-6 h-6 mr-2");

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("stroke-linecap", "round");
        path.setAttribute("stroke-linejoin", "round");
        path.setAttribute("stroke-width", "2");
        path.setAttribute(
          "d",
          "M13.828 9l3.182-3.182a1 1 0 00-1.415-1.415L12.414 7.586m-2.121 2.121L7.586 12.414a1 1 0 001.415 1.415L11 13.828"
        );
        linkIcon.appendChild(path);
        linkInfo.appendChild(linkIcon);

        const linkText = document.createElement("span");
        linkText.textContent = "Open Note";
        linkInfo.appendChild(linkText);

        card.appendChild(title);
        card.appendChild(linkInfo);

        fileList.appendChild(card);
      });
    }

    // Guard for login
    document.addEventListener("DOMContentLoaded", () => {
      if (!localStorage.getItem("loggedInUser")) {
        window.location.href = "index.html";
      } else {
        loadFiles();
      }
    });
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    #file-list {
      max-height: 65vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #4b5563 transparent;
    }
    #file-list::-webkit-scrollbar {
      width: 8px;
    }
    #file-list::-webkit-scrollbar-track {
      background: transparent;
    }
    #file-list::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-gray-950 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="flex justify-between items-center max-w-6xl mx-auto p-6">
    <h1 class="text-4xl font-extrabold flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-9 w-9 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a4 4 0 004 4h10a4 4 0 004-4V7M16 3v4M8 3v4M3 7h18" />
      </svg>
      Download Notes
    </h1>
    <button
      onclick="logout()"
      class="bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-2 rounded-lg shadow-lg transition"
      aria-label="Logout"
    >
      Logout
    </button>
  </header>

  <!-- Main content -->
  <main class="flex-grow max-w-6xl mx-auto p-6">
    <section
      id="file-list"
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8"
      aria-label="List of downloadable notes"
    >
      <!-- Notes will appear here -->
    </section>
  </main>

  <!-- Footer -->
  <footer class="text-center text-gray-500 text-sm py-8 select-none">
    &copy; 2025 NoteLagbe.com. Built for students, by students. üíô<br />
    Made with ‚ù§Ô∏è in Bangladesh üáßüá©
  </footer>
</body>
</html>
